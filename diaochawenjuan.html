
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRæŠ€æœ¯åœ¨æ–‡åŒ–é—äº§ä¼ æ’­ä¸­çš„åº”ç”¨ä¸æ•ˆæœæ¢ç´¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            position: relative;
            min-height: 250px;
            max-height: 400px;
            margin-bottom: 1rem;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .slider-container {
            margin: 20px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <header class="bg-gradient-to-r from-blue-700 to-indigo-800 text-white py-8 px-4 shadow-lg">
        <div class="container mx-auto max-w-6xl">
            <h1 class="text-3xl md:text-4xl font-bold mb-2">XRæŠ€æœ¯åœ¨æ–‡åŒ–é—äº§ä¼ æ’­ä¸­çš„åº”ç”¨ä¸æ•ˆæœæ¢ç´¢</h1>
            <p class="text-lg opacity-90">äº¤äº’å¼æ•°æ®å¯è§†åŒ–ä¸æ¨¡æ‹Ÿåˆ†æå¹³å°</p>
        </div>
    </header>

    <main class="container mx-auto max-w-6xl px-4 py-8">
        <!-- å¼•è¨€éƒ¨åˆ† -->
        <section class="mb-12 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold mb-4 text-indigo-700">æ¢ç´¢XRæŠ€æœ¯å¦‚ä½•æ”¹å˜æ–‡åŒ–é—äº§çš„ä¼ æ’­æ–¹å¼</h2>
            <p class="mb-4">éšç€XR(VR/AR/MR)æŠ€æœ¯çš„å‘å±•ï¼Œæ–‡åŒ–é—äº§çš„å±•ç¤ºä¸ä¼ æ’­æ–¹å¼æ­£åœ¨ç»å†å‰æ‰€æœªæœ‰çš„å˜é©ã€‚æœ¬äº¤äº’å¼å¹³å°åŸºäº208ä½ä¸åŒèƒŒæ™¯å—è®¿è€…çš„è°ƒæŸ¥æ•°æ®ï¼Œé€šè¿‡å¯è§†åŒ–åˆ†æå’Œæ¨¡æ‹Ÿå®éªŒï¼Œæ¢ç´¢XRæŠ€æœ¯åœ¨æ–‡åŒ–é—äº§ä¼ æ’­ä¸­çš„åº”ç”¨æ•ˆæœã€ç”¨æˆ·ä½“éªŒå’Œå‘å±•æ½œåŠ›ã€‚</p>
            
            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100">
                <h3 class="font-bold text-indigo-800 mb-2">ğŸ” æ¢ç´¢é—®é¢˜</h3>
                <p>XRæŠ€æœ¯å¦‚ä½•å½±å“äººä»¬å¯¹æ–‡åŒ–é—äº§çš„ç†è§£ã€å…´è¶£å’Œè®¤åŒæ„Ÿï¼Ÿä¸åŒèƒŒæ™¯çš„ç”¨æˆ·å¯¹XRæ–‡åŒ–ä½“éªŒæœ‰ä½•ä¸åŒååº”ï¼Ÿå“ªäº›å› ç´ å†³å®šäº†XRæ–‡åŒ–é—äº§åº”ç”¨çš„æˆåŠŸï¼Ÿ</p>
            </div>
        </section>

        <!-- ä¸»è¦äº¤äº’åŒºåŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="lg:col-span-1 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold mb-4 text-indigo-700">æ¨¡æ‹Ÿå‚æ•°æ§åˆ¶</h2>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">ç”¨æˆ·æ–‡åŒ–èƒŒæ™¯</label>
                    <select id="culturalBackground" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="all">å…¨éƒ¨èƒŒæ™¯</option>
                        <option value="education">æ–‡åŒ–æ•™è‚²</option>
                        <option value="museum">åšç‰©é¦†/æ–‡ç‰©</option>
                        <option value="tech">ç§‘æŠ€IT</option>
                        <option value="art">è‰ºæœ¯è®¾è®¡</option>
                        <option value="tourism">æ—…æ¸¸</option>
                        <option value="student">å­¦ç”Ÿ</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">XRä½“éªŒç±»å‹</label>
                    <select id="xrExperienceType" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="all">å…¨éƒ¨ä½“éªŒ</option>
                        <option value="museum">è™šæ‹Ÿåšç‰©é¦†å‚è§‚</option>
                        <option value="architecture">å¤å»ºç­‘å¤åŸ</option>
                        <option value="history">å†å²åœºæ™¯é‡ç°</option>
                        <option value="artifacts">æ–‡ç‰©3Då±•ç¤º</option>
                        <option value="life">å¤ä»£ç”Ÿæ´»ä½“éªŒ</option>
                        <option value="crafts">ä¼ ç»Ÿå·¥è‰ºå­¦ä¹ </option>
                        <option value="sites">æ–‡åŒ–é—å€æ¢ç´¢</option>
                    </select>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-1">XRæŠ€æœ¯è´¨é‡å› ç´ </label>
                    <div class="slider-container">
                        <label class="block text-xs text-gray-600 mb-1">è§†è§‰æ•ˆæœè´¨é‡</label>
                        <input type="range" id="visualQuality" min="1" max="5" value="3" class="w-full">
                        <div class="slider-label">
                            <span class="text-xs">ä½</span>
                            <span class="text-xs">é«˜</span>
                        </div>
                    </div>
                    
                    <div class="slider-container">
                        <label class="block text-xs text-gray-600 mb-1">å†å²å‡†ç¡®æ€§</label>
                        <input type="range" id="historicalAccuracy" min="1" max="5" value="3" class="w-full">
                        <div class="slider-label">
                            <span class="text-xs">ä½</span>
                            <span class="text-xs">é«˜</span>
                        </div>
                    </div>
                    
                    <div class="slider-container">
                        <label class="block text-xs text-gray-600 mb-1">äº¤äº’ä½“éªŒ</label>
                        <input type="range" id="interactionExperience" min="1" max="5" value="3" class="w-full">
                        <div class="slider-label">
                            <span class="text-xs">ä½</span>
                            <span class="text-xs">é«˜</span>
                        </div>
                    </div>
                    
                    <div class="slider-container">
                        <label class="block text-xs text-gray-600 mb-1">æ²‰æµ¸æ„Ÿ</label>
                        <input type="range" id="immersionLevel" min="1" max="5" value="3" class="w-full">
                        <div class="slider-label">
                            <span class="text-xs">ä½</span>
                            <span class="text-xs">é«˜</span>
                        </div>
                    </div>
                </div>
                
                <button id="runSimulation" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition">
                    è¿è¡Œæ¨¡æ‹Ÿ
                </button>
            </div>
            
            <!-- å³ä¾§ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="lg:col-span-2 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold mb-4 text-indigo-700">æ¨¡æ‹Ÿç»“æœ</h2>
                
                <div class="mb-4">
                    <div class="flex border-b border-gray-200">
                        <button class="tab-button py-2 px-4 font-medium border-b-2 border-indigo-500 text-indigo-600" data-tab="interest">å…´è¶£å˜åŒ–</button>
                        <button class="tab-button py-2 px-4 font-medium text-gray-500 hover:text-gray-700" data-tab="understanding">ç†è§£æ·±åº¦</button>
                        <button class="tab-button py-2 px-4 font-medium text-gray-500 hover:text-gray-700" data-tab="identity">æ–‡åŒ–è®¤åŒ</button>
                    </div>
                    
                    <div id="interest" class="tab-content active">
                        <div class="my-4">
                            <h3 class="text-lg font-medium text-gray-800 mb-2">XRä½“éªŒå¯¹æ–‡åŒ–å…´è¶£çš„å½±å“</h3>
                            <div class="chart-container">
                                <canvas id="interestChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div id="understanding" class="tab-content">
                        <div class="my-4">
                            <h3 class="text-lg font-medium text-gray-800 mb-2">XRä½“éªŒå¯¹æ–‡åŒ–ç†è§£çš„å½±å“</h3>
                            <div class="chart-container">
                                <canvas id="understandingChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div id="identity" class="tab-content">
                        <div class="my-4">
                            <h3 class="text-lg font-medium text-gray-800 mb-2">XRä½“éªŒå¯¹æ–‡åŒ–è®¤åŒçš„å½±å“</h3>
                            <div class="chart-container">
                                <canvas id="identityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-medium text-gray-800 mb-2">æ¨¡æ‹Ÿåˆ†æç»“æœ</h3>
                    <div id="simulationResults" class="text-gray-700">
                        è¯·è°ƒæ•´å‚æ•°å¹¶è¿è¡Œæ¨¡æ‹Ÿä»¥æŸ¥çœ‹ç»“æœã€‚
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ•°æ®å¯è§†åŒ–éƒ¨åˆ† -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 text-indigo-700">è°ƒæŸ¥æ•°æ®åˆ†æ</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- ç”¨æˆ·èƒŒæ™¯åˆ†å¸ƒ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-medium text-gray-800 mb-4">å—è®¿è€…æ–‡åŒ–èƒŒæ™¯åˆ†å¸ƒ</h3>
                    <div class="chart-container">
                        <canvas id="backgroundChart"></canvas>
                    </div>
                </div>
                
                <!-- XRä½“éªŒç±»å‹åˆ†å¸ƒ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-medium text-gray-800 mb-4">XRæ–‡åŒ–é—äº§ä½“éªŒç±»å‹</h3>
                    <div class="chart-container">
                        <canvas id="experienceTypeChart"></canvas>
                    </div>
                </div>
                
                <!-- XRæŠ€æœ¯è¡¨ç°è¯„ä»· -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-medium text-gray-800 mb-4">XRæŠ€æœ¯åœ¨æ–‡åŒ–é—äº§å±•ç¤ºä¸­çš„è¡¨ç°</h3>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                
                <!-- XRæŠ€æœ¯ä¼˜åŠ¿ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-medium text-gray-800 mb-4">XRæŠ€æœ¯åœ¨æ–‡åŒ–é—äº§å­¦ä¹ ä¸­çš„ä¼˜åŠ¿</h3>
                    <div class="chart-container">
                        <canvas id="advantagesChart"></canvas>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- å‘å±•å‰æ™¯éƒ¨åˆ† -->
        <section class="mb-12 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold mb-4 text-indigo-700">XRæ–‡åŒ–é—äº§åº”ç”¨å‘å±•å‰æ™¯</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- å‘å±•å‰æ™¯è¯„ä»· -->
                <div>
                    <h3 class="text-lg font-medium text-gray-800 mb-4">ç”¨æˆ·å¯¹XRæŠ€æœ¯åœ¨æ–‡åŒ–é—äº§é¢†åŸŸçš„å‘å±•å‰æ™¯è¯„ä»·</h3>
                    <div class="chart-container">
                        <canvas id="prospectChart"></canvas>
                    </div>
                </div>
                
                <!-- ä»˜è´¹æ„æ„¿ -->
                <div>
                    <h3 class="text-lg font-medium text-gray-800 mb-4">ç”¨æˆ·å¯¹XRæ–‡åŒ–é—äº§ä½“éªŒçš„ä»˜è´¹æ„æ„¿</h3>
                    <div class="chart-container">
                        <canvas id="paymentChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="mt-6">
                <h3 class="text-lg font-medium text-gray-800 mb-4">ç”¨æˆ·æœŸæœ›çš„XRæ–‡åŒ–é—äº§ä½“éªŒåŠŸèƒ½</h3>
                <div class="chart-container">
                    <canvas id="featuresChart"></canvas>
                </div>
            </div>
        </section>
        
        <!-- ç»“è®ºä¸å»ºè®® -->
        <section class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold mb-4 text-indigo-700">ç»“è®ºä¸å»ºè®®</h2>
            
            <div id="conclusionContent">
                <p class="mb-4">åŸºäºæ¨¡æ‹Ÿç»“æœå’Œæ•°æ®åˆ†æï¼Œæˆ‘ä»¬å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <h3 class="font-bold text-indigo-800 mb-2">XRæŠ€æœ¯çš„ç§¯æå½±å“</h3>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>æ˜¾è‘—æå‡ç”¨æˆ·å¯¹æ–‡åŒ–é—äº§çš„å…´è¶£ï¼ˆ67.3%ç”¨æˆ·å…´è¶£æœ‰æ‰€æˆ–å¤§å¹…å¢åŠ ï¼‰</li>
                            <li>å¢å¼ºæ–‡åŒ–è®¤åŒæ„Ÿï¼ˆ71.15%ç”¨æˆ·è®¤åŒæ„Ÿæœ‰æ‰€æˆ–æ˜¾è‘—å¢å¼ºï¼‰</li>
                            <li>æé«˜æ–‡åŒ–ç†è§£æ·±åº¦ï¼ˆ71.63%ç”¨æˆ·äº†è§£ç¨‹åº¦æœ‰æ‰€æˆ–æ˜¾è‘—æå‡ï¼‰</li>
                            <li>ä¿ƒè¿›æ–‡åŒ–é—äº§çš„å›½é™…ä¼ æ’­ï¼ˆ75.48%ç”¨æˆ·è®¤ä¸ºæœ‰ä¸€å®šæˆ–å¾ˆå¤§ä½œç”¨ï¼‰</li>
                        </ul>
                    </div>
                    
                    <div class="bg-amber-50 p-4 rounded-lg">
                        <h3 class="font-bold text-amber-800 mb-2">éœ€è¦æ”¹è¿›çš„æ–¹é¢</h3>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>å¤šè¯­è¨€æ”¯æŒå’Œæ–‡åŒ–èƒŒæ™¯è§£é‡Šï¼ˆåˆ†åˆ«æœ‰52.88%å’Œ53.37%ç”¨æˆ·è®¤ä¸ºéœ€è¦æ”¹è¿›ï¼‰</li>
                            <li>å†…å®¹ä¸°å¯Œæ€§å’Œæ“ä½œç®€ä¾¿æ€§ï¼ˆåˆ†åˆ«æœ‰47.8%å’Œ43.27%ç”¨æˆ·è®¤ä¸ºéœ€è¦æ”¹è¿›ï¼‰</li>
                            <li>äº¤äº’ä½“éªŒï¼ˆ37.98%ç”¨æˆ·è¯„ä»·ä¸ºä¸€èˆ¬ï¼Œ12.5%è¯„ä»·ä¸ºè¾ƒå·®ï¼‰</li>
                            <li>è·¨æ–‡åŒ–ç†è§£ï¼ˆ45.19%ç”¨æˆ·è®¤ä¸ºéœ€è¦ä¸€å®šæ–‡åŒ–èƒŒæ™¯æ‰èƒ½ç†è§£ï¼‰</li>
                        </ul>
                    </div>
                </div>
                
                <h3 class="text-lg font-medium text-gray-800 mb-2">å‘å±•å»ºè®®</h3>
                <ol class="list-decimal pl-5 space-y-2 mb-4">
                    <li><strong>ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</strong>ï¼šæé«˜è®¾å¤‡èˆ’é€‚åº¦å’Œæ“ä½œç®€ä¾¿æ€§ï¼Œé™ä½æŠ€æœ¯ä½¿ç”¨é—¨æ§›</li>
                    <li><strong>å¢å¼ºæ–‡åŒ–è§£é‡Š</strong>ï¼šåŠ å¼ºå¤šè¯­è¨€æ”¯æŒå’Œæ–‡åŒ–èƒŒæ™¯è§£é‡Šï¼Œä¿ƒè¿›è·¨æ–‡åŒ–ç†è§£</li>
                    <li><strong>ä¸°å¯Œäº¤äº’æ–¹å¼</strong>ï¼šå¼€å‘å¤šæ ·åŒ–çš„äº’åŠ¨åŠŸèƒ½ï¼Œå¦‚æ—¶é—´æ—…è¡Œä½“éªŒã€è§’è‰²æ‰®æ¼”å’Œå¤šäººåä½œæ¢ç´¢</li>
                    <li><strong>å¹³è¡¡æŠ€æœ¯ä¸å†…å®¹</strong>ï¼šåœ¨è¿½æ±‚æŠ€æœ¯åˆ›æ–°çš„åŒæ—¶ï¼Œç¡®ä¿å†å²å‡†ç¡®æ€§å’Œæ–‡åŒ–å†…æ¶µçš„ä¼ è¾¾</li>
                    <li><strong>æ‹“å±•åº”ç”¨åœºæ™¯</strong>ï¼šå°†XRæŠ€æœ¯åº”ç”¨åˆ°æ›´å¤šæ–‡åŒ–é—äº§ä¿æŠ¤ä¸ä¼ æ’­åœºæ™¯ï¼Œå¦‚å­¦æ ¡æ•™è‚²ã€æ—…æ¸¸æ™¯åŒºå’Œæ–‡åŒ–æ´»åŠ¨</li>
                </ol>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-6 px-4">
        <div class="container mx-auto max-w-6xl text-center">
            <p>Â© 2023 XRæ–‡åŒ–é—äº§ä¼ æ’­ç ”ç©¶é¡¹ç›® | äº¤äº’å¼æ•°æ®å¯è§†åŒ–ä¸æ¨¡æ‹Ÿåˆ†æå¹³å°</p>
        </div>
    </footer>

    <script>
        // å…¨å±€å˜é‡å­˜å‚¨å›¾è¡¨å®ä¾‹
        let charts = {};
        
        // æ¨¡æ‹Ÿæ•°æ®
        const surveyData = {
            culturalBackground: {
                'education': 14.42,
                'museum': 10.58,
                'tech': 17.79,
                'art': 8.65,
                'tourism': 5.29,
                'student': 37.02,
                'other': 6.25
            },
            experienceTypes: {
                'museum': 49.04,
                'architecture': 53.85,
                'history': 45.19,
                'artifacts': 53.85,
                'life': 39.42,
                'crafts': 27.88,
                'sites': 40.38,
                'other': 4.81
            },
            performance: {
                'visual': [20.67, 40.87, 25.48, 5.29, 7.69],
                'accuracy': [17.79, 30.29, 39.42, 4.33, 8.17],
                'interaction': [14.42, 32.69, 37.98, 12.5, 2.4],
                'immersion': [24.52, 39.42, 19.23, 12.98, 3.85]
            },
            advantages: {
                'understanding': 44.23,
                'interest': 47.12,
                'memory': 39.42,
                'interaction': 45.18,
                'personalization': 38.46,
                'sensory': 25.48,
                'other': 2.88
            },
            interestChange: {
                'increase_significantly': 27.4,
                'increase_somewhat': 39.9,
                'no_change': 17.31,
                'decrease_somewhat': 11.54,
                'decrease_significantly': 3.85
            },
            understandingLevel: {
                'improve_significantly': 20.67,
                'improve_somewhat': 50.96,
                'no_change': 9.13,
                'slightly_confused': 12.02,
                'more_confused': 7.21
            },
            culturalIdentity: {
                'strengthen_significantly': 31.73,
                'strengthen_somewhat': 39.42,
                'no_change': 16.83,
                'weaken_somewhat': 6.73,
                'weaken_significantly': 5.29
            },
            prospects: {
                'very_bright': 35.58,
                'bright': 38.94,
                'average': 6.73,
                'not_optimistic': 14.9,
                'pessimistic': 3.85
            },
            paymentWillingness: {
                'very_willing': 14.9,
                'acceptable': 67.79,
                'prefer_free': 14.42,
                'not_willing': 2.88
            },
            desiredFeatures: {
                'time_travel': 44.71,
                'role_playing': 41.35,
                'collaborative': 39.42,
                'personalized': 40.42,
                'social': 41.35,
                'creative': 37.5,
                'other': 1.92
            }
        };
        
        // åˆå§‹åŒ–å‡½æ•°
        function initialize() {
            try {
                // åˆå§‹åŒ–æ ‡ç­¾é¡µåˆ‡æ¢
                initTabs();
                
                // åˆå§‹åŒ–å›¾è¡¨
                initCharts();
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                document.getElementById('runSimulation').addEventListener('click', runSimulation);
                
                // åˆå§‹è¿è¡Œä¸€æ¬¡æ¨¡æ‹Ÿ
                runSimulation();
                
                console.log("åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–æ ‡ç­¾é¡µ
        function initTabs() {
            try {
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabContents = document.querySelectorAll('.tab-content');
                
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                        tabButtons.forEach(btn => {
                            btn.classList.remove('border-indigo-500', 'text-indigo-600');
                            btn.classList.add('text-gray-500');
                        });
                        
                        tabContents.forEach(content => {
                            content.classList.remove('active');
                        });
                        
                        // è®¾ç½®å½“å‰æ ‡ç­¾ä¸ºæ´»åŠ¨çŠ¶æ€
                        button.classList.add('border-indigo-500', 'text-indigo-600');
                        button.classList.remove('text-gray-500');
                        
                        const tabId = button.getAttribute('data-tab');
                        document.getElementById(tabId).classList.add('active');
                        
                        // é‡æ–°æ¸²æŸ“å½“å‰æ ‡ç­¾é¡µçš„å›¾è¡¨
                        setTimeout(() => {
                            if (tabId === 'interest' && charts.interestChart) {
                                charts.interestChart.update();
                            } else if (tabId === 'understanding' && charts.understandingChart) {
                                charts.understandingChart.update();
                            } else if (tabId === 'identity' && charts.identityChart) {
                                charts.identityChart.update();
                            }
                        }, 100);
                    });
                });
                
                console.log("æ ‡ç­¾é¡µåˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–æ ‡ç­¾é¡µæ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
        function initCharts() {
            try {
                // åˆå§‹åŒ–èƒŒæ™¯åˆ†å¸ƒå›¾è¡¨
                initBackgroundChart();
                
                // åˆå§‹åŒ–ä½“éªŒç±»å‹å›¾è¡¨
                initExperienceTypeChart();
                
                // åˆå§‹åŒ–æ€§èƒ½è¯„ä»·å›¾è¡¨
                initPerformanceChart();
                
                // åˆå§‹åŒ–ä¼˜åŠ¿å›¾è¡¨
                initAdvantagesChart();
                
                // åˆå§‹åŒ–å‰æ™¯å›¾è¡¨
                initProspectChart();
                
                // åˆå§‹åŒ–ä»˜è´¹æ„æ„¿å›¾è¡¨
                initPaymentChart();
                
                // åˆå§‹åŒ–æœŸæœ›åŠŸèƒ½å›¾è¡¨
                initFeaturesChart();
                
                // åˆå§‹åŒ–æ¨¡æ‹Ÿç»“æœå›¾è¡¨
                initSimulationCharts();
                
                console.log("æ‰€æœ‰å›¾è¡¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–å›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–èƒŒæ™¯åˆ†å¸ƒå›¾è¡¨
        function initBackgroundChart() {
            try {
                const ctx = document.getElementById('backgroundChart').getContext('2d');
                
                if (charts.backgroundChart) {
                    charts.backgroundChart.destroy();
                }
                
                charts.backgroundChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['æ–‡åŒ–æ•™è‚²', 'åšç‰©é¦†/æ–‡ç‰©', 'ç§‘æŠ€IT', 'è‰ºæœ¯è®¾è®¡', 'æ—…æ¸¸', 'å­¦ç”Ÿ', 'å…¶ä»–'],
                        datasets: [{
                            data: Object.values(surveyData.culturalBackground),
                            backgroundColor: [
                                '#4F46E5', '#7C3AED', '#2563EB', 
                                '#0EA5E9', '#06B6D4', '#10B981', '#84CC16'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 15,
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
                
                console.log("èƒŒæ™¯åˆ†å¸ƒå›¾è¡¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–èƒŒæ™¯åˆ†å¸ƒå›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–ä½“éªŒç±»å‹å›¾è¡¨
        function initExperienceTypeChart() {
            try {
                const ctx = document.getElementById('experienceTypeChart').getContext('2d');
                
                if (charts.experienceTypeChart) {
                    charts.experienceTypeChart.destroy();
                }
                
                charts.experienceTypeChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['è™šæ‹Ÿåšç‰©é¦†', 'å¤å»ºç­‘å¤åŸ', 'å†å²åœºæ™¯', 'æ–‡ç‰©3Då±•ç¤º', 'å¤ä»£ç”Ÿæ´»', 'ä¼ ç»Ÿå·¥è‰º', 'æ–‡åŒ–é—å€', 'å…¶ä»–'],
                        datasets: [{
                            label: 'ä½“éªŒæ¯”ä¾‹ (%)',
                            data: Object.values(surveyData.experienceTypes),
                            backgroundColor: '#4F46E5',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 60
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                console.log("ä½“éªŒç±»å‹å›¾è¡¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–ä½“éªŒç±»å‹å›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–æ€§èƒ½è¯„ä»·å›¾è¡¨
        function initPerformanceChart() {
            try {
                const ctx = document.getElementById('performanceChart').getContext('2d');
                
                if (charts.performanceChart) {
                    charts.performanceChart.destroy();
                }
                
                charts.performanceChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['è§†è§‰æ•ˆæœ', 'å†å²å‡†ç¡®æ€§', 'äº¤äº’ä½“éªŒ', 'æ²‰æµ¸æ„Ÿ'],
                        datasets: [
                            {
                                label: 'éå¸¸å¥½/è¾ƒå¥½',
                                data: [
                                    surveyData.performance.visual[0] + surveyData.performance.visual[1],
                                    surveyData.performance.accuracy[0] + surveyData.performance.accuracy[1],
                                    surveyData.performance.interaction[0] + surveyData.performance.interaction[1],
                                    surveyData.performance.immersion[0] + surveyData.performance.immersion[1]
                                ],
                                backgroundColor: 'rgba(79, 70, 229, 0.2)',
                                borderColor: 'rgba(79, 70, 229, 1)',
                                borderWidth: 2,
                                pointBackgroundColor: 'rgba(79, 70, 229, 1)'
                            },
                            {
                                label: 'ä¸€èˆ¬',
                                data: [
                                    surveyData.performance.visual[2],
                                    surveyData.performance.accuracy[2],
                                    surveyData.performance.interaction[2],
                                    surveyData.performance.immersion[2]
                                ],
                                backgroundColor: 'rgba(251, 191, 36, 0.2)',
                                borderColor: 'rgba(251, 191, 36, 1)',
                                borderWidth: 2,
                                pointBackgroundColor: 'rgba(251, 191, 36, 1)'
                            },
                            {
                                label: 'è¾ƒå·®/å¾ˆå·®',
                                data: [
                                    surveyData.performance.visual[3] + surveyData.performance.visual[4],
                                    surveyData.performance.accuracy[3] + surveyData.performance.accuracy[4],
                                    surveyData.performance.interaction[3] + surveyData.performance.interaction[4],
                                    surveyData.performance.immersion[3] + surveyData.performance.immersion[4]
                                ],
                                backgroundColor: 'rgba(239, 68, 68, 0.2)',
                                borderColor: 'rgba(239, 68, 68, 1)',
                                borderWidth: 2,
                                pointBackgroundColor: 'rgba(239, 68, 68, 1)'
                            }
                        ]
                    },
                    options: {
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                min: 0,
                                max: 70,
                                ticks: {
                                    stepSize: 20
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
                
                console.log("æ€§èƒ½è¯„ä»·å›¾è¡¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–æ€§èƒ½è¯„ä»·å›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–ä¼˜åŠ¿å›¾è¡¨
        function initAdvantagesChart() {
            try {
                const ctx = document.getElementById('advantagesChart').getContext('2d');
                
                if (charts.advantagesChart) {
                    charts.advantagesChart.destroy();
                }
                
                charts.advantagesChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['å¢å¼ºç†è§£æ·±åº¦', 'æé«˜å­¦ä¹ å…´è¶£', 'è®°å¿†æ›´åŠ æ·±åˆ»', 'æä¾›äº’åŠ¨ä½“éªŒ', 'ä¸ªæ€§åŒ–å­¦ä¹ ', 'å¤šæ„Ÿå®˜å‚ä¸', 'å…¶ä»–'],
                        datasets: [{
                            label: 'é€‰æ‹©æ¯”ä¾‹ (%)',
                            data: Object.values(surveyData.advantages),
                            backgroundColor: '#10B981',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 50
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                console.log("ä¼˜åŠ¿å›¾è¡¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–ä¼˜åŠ¿å›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–å‰æ™¯å›¾è¡¨
        function initProspectChart() {
            try {
                const ctx = document.getElementById('prospectChart').getContext('2d');
                
                if (charts.prospectChart) {
                    charts.prospectChart.destroy();
                }
                
                charts.prospectChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['éå¸¸å…‰æ˜', 'æ¯”è¾ƒå…‰æ˜', 'ä¸€èˆ¬', 'ä¸å¤ªä¹è§‚', 'å¾ˆä¸ä¹è§‚'],
                        datasets: [{
                            data: Object.values(surveyData.prospects),
                            backgroundColor: [
                                '#10B981', '#34D399', '#FBBF24', 
                                '#F59E0B', '#EF4444'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 15,
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
                
                console.log("å‰æ™¯å›¾è¡¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–å‰æ™¯å›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–ä»˜è´¹æ„æ„¿å›¾è¡¨
        function initPaymentChart() {
            try {
                const ctx = document.getElementById('paymentChart').getContext('2d');
                
                if (charts.paymentChart) {
                    charts.paymentChart.destroy();
                }
                
                charts.paymentChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['å¾ˆæ„¿æ„ä»˜è´¹', 'é€‚å½“ä»˜è´¹å¯æ¥å—', 'å¸Œæœ›å…è´¹ä½“éªŒ', 'å®Œå…¨ä¸æ„¿ä»˜è´¹'],
                        datasets: [{
                            data: Object.values(surveyData.paymentWillingness),
                            backgroundColor: [
                                '#4F46E5', '#818CF8', '#FBBF24', '#F87171'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 15,
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
                
                console.log("ä»˜è´¹æ„æ„¿å›¾è¡¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–ä»˜è´¹æ„æ„¿å›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–æœŸæœ›åŠŸèƒ½å›¾è¡¨
        function initFeaturesChart() {
            try {
                const ctx = document.getElementById('featuresChart').getContext('2d');
                
                if (charts.featuresChart) {
                    charts.featuresChart.destroy();
                }
                
                charts.featuresChart = new Chart(ctx, {
                    type: 'polarArea',
                    data: {
                        labels: ['æ—¶é—´æ—…è¡Œä½“éªŒ', 'è§’è‰²æ‰®æ¼”äº’åŠ¨', 'å¤šäººåä½œæ¢ç´¢', 'ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„', 'ç¤¾äº¤åˆ†äº«åŠŸèƒ½', 'åˆ›ä½œå·¥å…·', 'å…¶ä»–'],
                        datasets: [{
                            data: Object.values(surveyData.desiredFeatures),
                            backgroundColor: [
                                'rgba(79, 70, 229, 0.7)',
                                'rgba(124, 58, 237, 0.7)',
                                'rgba(37, 99, 235, 0.7)',
                                'rgba(14, 165, 233, 0.7)',
                                'rgba(6, 182, 212, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(132, 204, 22, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                max: 50
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 15,
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
                
                console.log("æœŸæœ›åŠŸèƒ½å›¾è¡¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–æœŸæœ›åŠŸèƒ½å›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // åˆå§‹åŒ–æ¨¡æ‹Ÿç»“æœå›¾è¡¨
        function initSimulationCharts() {
            try {
                // å…´è¶£å˜åŒ–å›¾è¡¨
                const interestCtx = document.getElementById('interestChart').getContext('2d');
                
                if (charts.interestChart) {
                    charts.interestChart.destroy();
                }
                
                charts.interestChart = new Chart(interestCtx, {
                    type: 'bar',
                    data: {
                        labels: ['å¤§å¹…å¢åŠ ', 'æœ‰æ‰€å¢åŠ ', 'æ— å˜åŒ–', 'ç•¥æœ‰å‡å°‘', 'æ˜æ˜¾å‡å°‘'],
                        datasets: [{
                            label: 'æ¯”ä¾‹ (%)',
                            data: Object.values(surveyData.interestChange),
                            backgroundColor: [
                                '#10B981', '#34D399', '#D1D5DB', 
                                '#F59E0B', '#EF4444'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 50
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                // ç†è§£æ·±åº¦å›¾è¡¨
                const understandingCtx = document.getElementById('understandingChart').getContext('2d');
                
                if (charts.understandingChart) {
                    charts.understandingChart.destroy();
                }
                
                charts.understandingChart = new Chart(understandingCtx, {
                    type: 'bar',
                    data: {
                        labels: ['æ˜¾è‘—æå‡', 'æœ‰æ‰€æå‡', 'åŸºæœ¬æ— å˜åŒ–', 'ç•¥æœ‰å›°æƒ‘', 'æ›´åŠ å›°æƒ‘'],
                        datasets: [{
                            label: 'æ¯”ä¾‹ (%)',
                            data: Object.values(surveyData.understandingLevel),
                            backgroundColor: [
                                '#10B981', '#34D399', '#D1D5DB', 
                                '#F59E0B', '#EF4444'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 60
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                // æ–‡åŒ–è®¤åŒå›¾è¡¨
                const identityCtx = document.getElementById('identityChart').getContext('2d');
                
                if (charts.identityChart) {
                    charts.identityChart.destroy();
                }
                
                charts.identityChart = new Chart(identityCtx, {
                    type: 'bar',
                    data: {
                        labels: ['æ˜¾è‘—å¢å¼º', 'æœ‰æ‰€å¢å¼º', 'æ— æ˜æ˜¾å˜åŒ–', 'ç•¥æœ‰å‰Šå¼±', 'æ˜æ˜¾å‰Šå¼±'],
                        datasets: [{
                            label: 'æ¯”ä¾‹ (%)',
                            data: Object.values(surveyData.culturalIdentity),
                            backgroundColor: [
                                '#10B981', '#34D399', '#D1D5DB', 
                                '#F59E0B', '#EF4444'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 50
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                console.log("æ¨¡æ‹Ÿç»“æœå›¾è¡¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                console.error("åˆå§‹åŒ–æ¨¡æ‹Ÿç»“æœå›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        }
        
        // è¿è¡Œæ¨¡æ‹Ÿ
        function runSimulation() {
            try {
                // è·å–ç”¨æˆ·é€‰æ‹©çš„å‚æ•°
                const culturalBackground = document.getElementById('culturalBackground').value;
                const xrExperienceType = document.getElementById('xrExperienceType').value;
                const visualQuality = parseInt(document.getElementById('visualQuality').value);
                const historicalAccuracy = parseInt(document.getElementById('historicalAccuracy').value);
                const interactionExperience = parseInt(document.getElementById('interactionExperience').value);
                const immersionLevel = parseInt(document.getElementById('immersionLevel').value);
                
                console.log("æ¨¡æ‹Ÿå‚æ•°:", {
                    culturalBackground,
                    xrExperienceType,
                    visualQuality,
                    historicalAccuracy,
                    interactionExperience,
                    immersionLevel
                });
                
                // è®¡ç®—æ¨¡æ‹Ÿç»“æœ
                const simulationResults = calculateSimulationResults(
                    culturalBackground,
                    xrExperienceType,
                    visualQuality,
                    historicalAccuracy,
                    interactionExperience,
                    immersionLevel
                );
                
                // æ›´æ–°æ¨¡æ‹Ÿç»“æœå›¾è¡¨
                updateSimulationCharts(simulationResults);
                
                // æ›´æ–°æ¨¡æ‹Ÿåˆ†æç»“æœæ–‡æœ¬
                updateSimulationText(simulationResults);
                
                console.log("æ¨¡æ‹Ÿè¿è¡Œå®Œæˆ");
            } catch (error) {
                console.error("è¿è¡Œæ¨¡æ‹Ÿæ—¶å‘ç”Ÿé”™è¯¯:", error);
                document.getElementById('simulationResults').innerHTML = `
                    <div class="bg-red-50 p-3 rounded-md text-red-700">
                        <p>æ¨¡æ‹Ÿè¿è¡Œå‡ºé”™ï¼Œè¯·æ£€æŸ¥å‚æ•°è®¾ç½®åé‡è¯•ã€‚</p>
                    </div>
                `;
            }
        }
        
        // è®¡ç®—æ¨¡æ‹Ÿç»“æœ
        function calculateSimulationResults(culturalBackground, xrExperienceType, visualQuality, historicalAccuracy, interactionExperience, immersionLevel) {
            try {
                // åŸºç¡€å½±å“å› å­
                let interestFactor = 0;
                let understandingFactor = 0;
                let identityFactor = 0;
                
                // æŠ€æœ¯è´¨é‡å½±å“
                const qualityScore = (visualQuality + historicalAccuracy + interactionExperience + immersionLevel) / 4;
                
                // æ ¹æ®æŠ€æœ¯è´¨é‡è°ƒæ•´åŸºç¡€å› å­
                if (qualityScore >= 4) {
                    interestFactor += 0.3;
                    understandingFactor += 0.25;
                    identityFactor += 0.3;
                } else if (qualityScore >= 3) {
                    interestFactor += 0.15;
                    understandingFactor += 0.1;
                    identityFactor += 0.15;
                } else {
                    interestFactor -= 0.1;
                    understandingFactor -= 0.15;
                    identityFactor -= 0.05;
                }
                
                // æ²‰æµ¸æ„Ÿå¯¹å…´è¶£çš„ç‰¹æ®Šå½±å“
                interestFactor += (immersionLevel - 3) * 0.1;
                
                // å†å²å‡†ç¡®æ€§å¯¹ç†è§£å’Œè®¤åŒçš„ç‰¹æ®Šå½±å“
                understandingFactor += (historicalAccuracy - 3) * 0.15;
                identityFactor += (historicalAccuracy - 3) * 0.1;
                
                // äº¤äº’ä½“éªŒå¯¹ç†è§£çš„ç‰¹æ®Šå½±å“
                understandingFactor += (interactionExperience - 3) * 0.1;
                
                // è§†è§‰æ•ˆæœå¯¹å…´è¶£çš„ç‰¹æ®Šå½±å“
                interestFactor += (visualQuality - 3) * 0.1;
                
                // æ ¹æ®æ–‡åŒ–èƒŒæ™¯è°ƒæ•´
                if (culturalBackground !== 'all') {
                    if (culturalBackground === 'education' || culturalBackground === 'museum') {
                        // æ–‡åŒ–æ•™è‚²å’Œåšç‰©é¦†èƒŒæ™¯çš„äººå¯¹å†å²å‡†ç¡®æ€§æ›´æ•æ„Ÿ
                        understandingFactor += historicalAccuracy * 0.05;
                        identityFactor += historicalAccuracy * 0.05;
                    } else if (culturalBackground === 'tech') {
                        // ç§‘æŠ€èƒŒæ™¯çš„äººå¯¹æŠ€æœ¯è´¨é‡æ›´æ•æ„Ÿ
                        interestFactor += visualQuality * 0.05;
                        interestFactor += interactionExperience * 0.05;
                    } else if (culturalBackground === 'art') {
                        // è‰ºæœ¯èƒŒæ™¯çš„äººå¯¹è§†è§‰æ•ˆæœæ›´æ•æ„Ÿ
                        interestFactor += visualQuality * 0.1;
                        identityFactor += visualQuality * 0.05;
                    } else if (culturalBackground === 'student') {
                        // å­¦ç”Ÿå¯¹äº’åŠ¨ä½“éªŒæ›´æ•æ„Ÿ
                        interestFactor += interactionExperience * 0.1;
                        understandingFactor += interactionExperience * 0.05;
                    }
                }
                
                // æ ¹æ®ä½“éªŒç±»å‹è°ƒæ•´
                if (xrExperienceType !== 'all') {
                    if (xrExperienceType === 'history' || xrExperienceType === 'life') {
                        // å†å²åœºæ™¯å’Œå¤ä»£ç”Ÿæ´»ä½“éªŒå¯¹æ–‡åŒ–è®¤åŒå½±å“æ›´å¤§
                        identityFactor += 0.15;
                    } else if (xrExperienceType === 'architecture' || xrExperienceType === 'sites') {
                        // å¤å»ºç­‘å’Œæ–‡åŒ–é—å€å¯¹ç†è§£å½±å“æ›´å¤§
                        understandingFactor += 0.15;
                    } else if (xrExperienceType === 'crafts') {
                        // ä¼ ç»Ÿå·¥è‰ºå­¦ä¹ å¯¹å…´è¶£å½±å“æ›´å¤§
                        interestFactor += 0.2;
                    }
                }
                
                // è®¡ç®—æœ€ç»ˆç»“æœ
                // å°†å› å­è½¬æ¢ä¸ºç™¾åˆ†æ¯”å˜åŒ–
                const interestChange = calculateDistribution(interestFactor);
                const understandingChange = calculateDistribution(understandingFactor);
                const identityChange = calculateDistribution(identityFactor);
                
                // è®¡ç®—æ€»ä½“è¯„åˆ†
                const overallScore = Math.min(100, Math.max(0, 50 + (interestFactor + understandingFactor + identityFactor) * 20));
                
                // ç”Ÿæˆå…³é”®å‘ç°
                const keyFindings = generateKeyFindings(
                    culturalBackground,
                    xrExperienceType,
                    qualityScore,
                    interestFactor,
                    understandingFactor,
                    identityFactor
                );
                
                return {
                    interestChange,
                    understandingChange,
                    identityChange,
                    overallScore,
                    keyFindings
                };
            } catch (error) {
                console.error("è®¡ç®—æ¨¡æ‹Ÿç»“æœæ—¶å‘ç”Ÿé”™è¯¯:", error);
                throw error;
            }
        }
        
        // æ ¹æ®å› å­è®¡ç®—åˆ†å¸ƒ
        function calculateDistribution(factor) {
            try {
                // åŸºç¡€åˆ†å¸ƒ
                let distribution = {
                    positive_strong: 25,
                    positive_moderate: 40,
                    neutral: 20,
                    negative_moderate: 10,
                    negative_strong: 5
                };
                
                // æ ¹æ®å› å­è°ƒæ•´åˆ†å¸ƒ
                if (factor > 0) {
                    // æ­£é¢å› å­ï¼Œå¢åŠ æ­£é¢å½±å“
                    const shift = factor * 30;
                    distribution.positive_strong += shift * 0.6;
                    distribution.positive_moderate += shift * 0.4;
                    distribution.neutral -= shift * 0.5;
                    distribution.negative_moderate -= shift * 0.3;
                    distribution.negative_strong -= shift * 0.2;
                } else if (factor < 0) {
                    // è´Ÿé¢å› å­ï¼Œå¢åŠ è´Ÿé¢å½±å“
                    const shift = Math.abs(factor) * 30;
                    distribution.positive_strong -= shift * 0.4;
                    distribution.positive_moderate -= shift * 0.3;
                    distribution.neutral -= shift * 0.3;
                    distribution.negative_moderate += shift * 0.5;
                    distribution.negative_strong += shift * 0.5;
                }
                
                // ç¡®ä¿æ‰€æœ‰å€¼éƒ½åœ¨åˆç†èŒƒå›´å†…
                for (let key in distribution) {
                    distribution[key] = Math.min(70, Math.max(0, distribution[key]));
                }
                
                // å½’ä¸€åŒ–ï¼Œç¡®ä¿æ€»å’Œä¸º100
                const total = Object.values(distribution).reduce((sum, val) => sum + val, 0);
                for (let key in distribution) {
                    distribution[key] = (distribution[key] / total) * 100;
                }
                
                return distribution;
            } catch (error) {
                console.error("è®¡ç®—åˆ†å¸ƒæ—¶å‘ç”Ÿé”™è¯¯:", error);
                throw error;
            }
        }
        
        // ç”Ÿæˆå…³é”®å‘ç°
        function generateKeyFindings(culturalBackground, xrExperienceType, qualityScore, interestFactor, understandingFactor, identityFactor) {
            try {
                const findings = [];
                
                // æ€»ä½“è´¨é‡è¯„ä»·
                if (qualityScore >= 4) {
                    findings.push("é«˜è´¨é‡çš„XRä½“éªŒæ˜¾è‘—æå‡äº†ç”¨æˆ·å¯¹æ–‡åŒ–é—äº§çš„å…´è¶£ã€ç†è§£å’Œè®¤åŒæ„Ÿã€‚");
                } else if (qualityScore >= 3) {
                    findings.push("ä¸­ç­‰è´¨é‡çš„XRä½“éªŒå¯¹ç”¨æˆ·çš„æ–‡åŒ–ä½“éªŒæœ‰ä¸€å®šç§¯æå½±å“ã€‚");
                } else {
                    findings.push("ä½è´¨é‡çš„XRä½“éªŒå¯èƒ½å¯¹ç”¨æˆ·çš„æ–‡åŒ–ä½“éªŒäº§ç”Ÿè´Ÿé¢å½±å“ã€‚");
                }
                
                // æ ¹æ®æ–‡åŒ–èƒŒæ™¯çš„ç‰¹æ®Šå‘ç°
                if (culturalBackground !== 'all') {
                    if (culturalBackground === 'education' || culturalBackground === 'museum') {
                        findings.push("æ–‡åŒ–æ•™è‚²å’Œåšç‰©é¦†èƒŒæ™¯çš„ç”¨æˆ·å¯¹å†å²å‡†ç¡®æ€§æ›´ä¸ºæ•æ„Ÿï¼Œé«˜å‡†ç¡®æ€§å†…å®¹èƒ½æ˜¾è‘—æå‡å…¶ç†è§£å’Œè®¤åŒã€‚");
                    } else if (culturalBackground === 'tech') {
                        findings.push("ç§‘æŠ€èƒŒæ™¯çš„ç”¨æˆ·æ›´å…³æ³¨æŠ€æœ¯å®ç°è´¨é‡ï¼Œé«˜è´¨é‡çš„è§†è§‰æ•ˆæœå’Œäº¤äº’ä½“éªŒèƒ½æ˜¾è‘—æå‡å…¶å…´è¶£ã€‚");
                    } else if (culturalBackground === 'art') {
                        findings.push("è‰ºæœ¯èƒŒæ™¯çš„ç”¨æˆ·å¯¹è§†è§‰è¡¨ç°æ›´ä¸ºæ•æ„Ÿï¼Œç²¾ç¾çš„è§†è§‰æ•ˆæœèƒ½æ˜¾è‘—æå‡å…¶å…´è¶£å’Œæ–‡åŒ–è®¤åŒã€‚");
                    } else if (culturalBackground === 'student') {
                        findings.push("å­¦ç”Ÿç”¨æˆ·å¯¹äº’åŠ¨ä½“éªŒååº”æ›´ä¸ºç§¯æï¼Œè‰¯å¥½çš„äº¤äº’è®¾è®¡èƒ½æ˜¾è‘—æå‡å…¶å­¦ä¹ å…´è¶£å’Œç†è§£ã€‚");
                    }
                }
                
                // æ ¹æ®ä½“éªŒç±»å‹çš„ç‰¹æ®Šå‘ç°
                if (xrExperienceType !== 'all') {
                    if (xrExperienceType === 'history' || xrExperienceType === 'life') {
                        findings.push("å†å²åœºæ™¯é‡ç°å’Œå¤ä»£ç”Ÿæ´»ä½“éªŒå¯¹å¢å¼ºæ–‡åŒ–è®¤åŒæ„Ÿç‰¹åˆ«æœ‰æ•ˆã€‚");
                    } else if (xrExperienceType === 'architecture' || xrExperienceType === 'sites') {
                        findings.push("å¤å»ºç­‘å¤åŸå’Œæ–‡åŒ–é—å€æ¢ç´¢å¯¹æå‡æ–‡åŒ–ç†è§£æ·±åº¦ç‰¹åˆ«æœ‰æ•ˆã€‚");
                    } else if (xrExperienceType === 'crafts') {
                        findings.push("ä¼ ç»Ÿå·¥è‰ºå­¦ä¹ ä½“éªŒå¯¹æ¿€å‘ç”¨æˆ·å…´è¶£ç‰¹åˆ«æœ‰æ•ˆã€‚");
                    }
                }
                
                // æ ¹æ®å„å› å­çš„å¼ºå¼±æä¾›å…·ä½“å»ºè®®
                const factors = [
                    { name: "è§†è§‰æ•ˆæœ", value: document.getElementById('visualQuality').value },
                    { name: "å†å²å‡†ç¡®æ€§", value: document.getElementById('historicalAccuracy').value },
                    { name: "äº¤äº’ä½“éªŒ", value: document.getElementById('interactionExperience').value },
                    { name: "æ²‰æµ¸æ„Ÿ", value: document.getElementById('immersionLevel').value }
                ];
                
                // æ‰¾å‡ºæœ€å¼±çš„å› ç´ 
                factors.sort((a, b) => a.value - b.value);
                if (factors[0].value < 3) {
                    findings.push(`æ”¹è¿›${factors[0].name}å¯èƒ½æ˜¯æå‡æ•´ä½“ä½“éªŒæ•ˆæœçš„å…³é”®ã€‚`);
                }
                
                // æ‰¾å‡ºæœ€å¼ºçš„å› ç´ 
                factors.sort((a, b) => b.value - a.value);
                if (factors[0].value > 3) {
                    findings.push(`${factors[0].name}æ˜¯å½“å‰ä½“éªŒçš„ä¼˜åŠ¿ï¼Œå¯ä»¥ä½œä¸ºç‰¹è‰²è¿›ä¸€æ­¥å¼ºåŒ–ã€‚`);
                }
                
                return findings;
            } catch (error) {
                console.error("ç”Ÿæˆå…³é”®å‘ç°æ—¶å‘ç”Ÿé”™è¯¯:", error);
                throw error;
            }
        }
        
        // æ›´æ–°æ¨¡æ‹Ÿç»“æœå›¾è¡¨
        function updateSimulationCharts(results) {
            try {
                // æ›´æ–°å…´è¶£å˜åŒ–å›¾è¡¨
                if (charts.interestChart) {
                    charts.interestChart.data.datasets[0].data = [
                        results.interestChange.positive_strong,
                        results.interestChange.positive_moderate,
                        results.interestChange.neutral,
                        results.interestChange.negative_moderate,
                        results.interestChange.negative_strong
                    ];
                    charts.interestChart.update();
                }
                
                // æ›´æ–°ç†è§£æ·±åº¦å›¾è¡¨
                if (charts.understandingChart) {
                    charts.understandingChart.data.datasets[0].data = [
                        results.understandingChange.positive_strong,
                        results.understandingChange.positive_moderate,
                        results.understandingChange.neutral,
                        results.understandingChange.negative_moderate,
                        results.understandingChange.negative_strong
                    ];
                    charts.understandingChart.update();
                }
                
                // æ›´æ–°æ–‡åŒ–è®¤åŒå›¾è¡¨
                if (charts.identityChart) {
                    charts.identityChart.data.datasets[0].data = [
                        results.identityChange.positive_strong,
                        results.identityChange.positive_moderate,
                        results.identityChange.neutral,
                        results.identityChange.negative_moderate,
                        results.identityChange.negative_strong
                    ];
                    charts.identityChart.update();
                }
                
                console.log("æ¨¡æ‹Ÿç»“æœå›¾è¡¨æ›´æ–°å®Œæˆ");
            } catch (error) {
                console.error("æ›´æ–°æ¨¡æ‹Ÿç»“æœå›¾è¡¨æ—¶å‘ç”Ÿé”™è¯¯:", error);
                throw error;
            }
        }
        
        // æ›´æ–°æ¨¡æ‹Ÿåˆ†æç»“æœæ–‡æœ¬
        function updateSimulationText(results) {
            try {
                const resultsElement = document.getElementById('simulationResults');
                
                // è·å–ç”¨æˆ·é€‰æ‹©çš„å‚æ•°åç§°
                const culturalBackgroundSelect = document.getElementById('culturalBackground');
                const culturalBackgroundText = culturalBackgroundSelect.options[culturalBackgroundSelect.selectedIndex].text;
                
                const xrExperienceTypeSelect = document.getElementById('xrExperienceType');
                const xrExperienceTypeText = xrExperienceTypeSelect.options[xrExperienceTypeSelect.selectedIndex].text;
                
                // ç”Ÿæˆç»“æœæ–‡æœ¬
                let resultHTML = `
                    <div class="mb-4">
                        <div class="flex items-center mb-2">
                            <div class="w-24 text-sm text-gray-500">æ€»ä½“è¯„åˆ†ï¼š</div>
                            <div class="flex-1 bg-gray-200 rounded-full h-4">
                                <div class="h-4 rounded-full ${results.overallScore >= 70 ? 'bg-green-500' : results.overallScore >= 50 ? 'bg-yellow-500' : 'bg-red-500'}" 
                                    style="width: ${results.overallScore}%"></div>
                            </div>
                            <div class="ml-2 font-medium">${Math.round(results.overallScore)}%</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-medium text-gray-800 mb-2">æ¨¡æ‹Ÿç»“æœåˆ†æ</h4>
                        <p class="text-sm text-gray-700 mb-2">
                            åŸºäºå½“å‰å‚æ•°è®¾ç½®ï¼Œ${culturalBackgroundText !== "å…¨éƒ¨èƒŒæ™¯" ? culturalBackgroundText + "èƒŒæ™¯çš„" : ""}ç”¨æˆ·åœ¨ä½“éªŒ${xrExperienceTypeText !== "å…¨éƒ¨ä½“éªŒ" ? xrExperienceTypeText : "XRæ–‡åŒ–é—äº§åº”ç”¨"}åï¼š
                        </p>
                        <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
                            <li>${Math.round(results.interestChange.positive_strong + results.interestChange.positive_moderate)}% çš„ç”¨æˆ·æ–‡åŒ–å…´è¶£æœ‰æ‰€æˆ–å¤§å¹…å¢åŠ </li>
                            <li>${Math.round(results.understandingChange.positive_strong + results.understandingChange.positive_moderate)}% çš„ç”¨æˆ·æ–‡åŒ–ç†è§£æœ‰æ‰€æˆ–æ˜¾è‘—æå‡</li>
                            <li>${Math.round(results.identityChange.positive_strong + results.identityChange.positive_moderate)}% çš„ç”¨æˆ·æ–‡åŒ–è®¤åŒæ„Ÿæœ‰æ‰€æˆ–æ˜¾è‘—å¢å¼º</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-800 mb-2">å…³é”®å‘ç°</h4>
                        <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
                            ${results.keyFindings.map(finding => `<li>${finding}</li>`).join('')}
                        </ul>
                    </div>
                `;
                
                resultsElement.innerHTML = resultHTML;
                
                console.log("æ¨¡æ‹Ÿåˆ†æç»“æœæ–‡æœ¬æ›´æ–°å®Œæˆ");
            } catch (error) {
                console.error("æ›´æ–°æ¨¡æ‹Ÿåˆ†æç»“æœæ–‡æœ¬æ—¶å‘ç”Ÿé”™è¯¯:", error);
                throw error;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', initialize);
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´å›¾è¡¨
        window.addEventListener('resize', function() {
            try {
                // å»¶è¿Ÿæ‰§è¡Œä»¥é¿å…é¢‘ç¹è°ƒç”¨
                if (this.resizeTimeout) {
                    clearTimeout(this.resizeTimeout);
                }
                
                this.resizeTimeout = setTimeout(function() {
                    // æ›´æ–°æ‰€æœ‰å›¾è¡¨
                    for (let chartName in charts) {
                        if (charts[chartName]) {
                            charts[chartName].resize();
                            charts[chartName].update();
                        }
                    }
                    
                    console.log("çª—å£å¤§å°å˜åŒ–ï¼Œå›¾è¡¨å·²é‡æ–°è°ƒæ•´");
                }, 200);
            } catch (error) {
                console.error("çª—å£å¤§å°å˜åŒ–å¤„ç†æ—¶å‘ç”Ÿé”™è¯¯:", error);
            }
        });
    </script>
<script>window.parent.postMessage({ action: "ready" }, "*"); 
 
window.console = new Proxy(console, {
  get(target, prop) {
    if (['log', 'warn', 'error'].includes(prop)) {
      return new Proxy(target[prop], {
        apply(fn, thisArg, args) {
          fn.apply(thisArg, args);
          window.parent.postMessage({ action: 'console', 
            type: prop, 
            args: args.map((arg) => {
              try {
                return JSON.stringify(arg).replace(/^["']|["']$/g, '');
              } catch (e) {
                return arg;
              }
            }) 
          }, '*');
        }
      });
    }
    return target[prop];
  }
});
</script></body>
</html>
